<div class="qs-form-container" style="position: relative">
  <form [formGroup]="userSettingsFormGroup" (submit)="onSubmit($event)" class="qs-form">
    <mat-tab-group [dynamicHeight]="true">

      <mat-tab label="Profile Settings">
        <app-shade [isActive]="isSaving || isDeleting" [hasError]="errorSaving || errorDeleting"
          [errorMessage]="errorSaving || errorDeleting"></app-shade>
        <ng-template matTabLabel>
          <mat-icon matTooltip="Profile Settings">person</mat-icon>
        </ng-template>

        <mat-card class="mat-elevation-z0 qs-form-section">
          <mat-card-header>
            <mat-card-subtitle>
              Profile settings
            </mat-card-subtitle>
          </mat-card-header>
          <mat-divider></mat-divider>

          <mat-form-field>
            <input matInput placeholder="Name" formControlName="displayName">
            <mat-hint>Quite apparent, the name you would like to use</mat-hint>
            @if (hasError('displayName')) {
            <mat-error>
              Name must not be empty
            </mat-error>
            }
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Privacy" formControlName="privacy">
              <mat-option [value]="privacy.Public">Public</mat-option>
              <mat-option [value]="privacy.Private">Private</mat-option>
            </mat-select>
            <mat-hint><b>Tip:</b> Public profiles can be shared</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <input matInput placeholder="Your bio, description or anything you want to share..."
              formControlName="description">
            <mat-hint>This can be something that if your profile is public other users can see</mat-hint>
            @if (hasError('description')) {
            <mat-error>
              Description must not be empty
            </mat-error>
            }
          </mat-form-field>

          <mat-form-field>
            <input matInput
              placeholder="A brand text that will appear in places that 'quantified-Self.io' appears at the moment"
              formControlName="brandText">
            <mat-hint>Contact us for a branded account</mat-hint>
            @if (hasError('brandText')) {
            <mat-error>
              Brand text error
            </mat-error>
            }
          </mat-form-field>

          <br>
          <br>
          <br>

          <mat-accordion>
            <mat-expansion-panel class="mat-elevation-z0"
              style="border: 1px solid red; background: rgba(255, 0, 0, 0.05);">
              <mat-expansion-panel-header>
                <mat-panel-title style="color: red;">
                  Danger Zone
                </mat-panel-title>
                <mat-panel-description style="color: red;">
                  Delete account
                </mat-panel-description>
              </mat-expansion-panel-header>

              <p>Once you delete your account, there is no going back. Please be certain.</p>

              @if (!consentToDelete) {
              <button mat-flat-button color="warn" (click)="$event.preventDefault(); consentToDelete = true">
                DELETE MY ACCOUNT
              </button>
              }
              @if (consentToDelete) {
              <button mat-flat-button color="warn" (click)="deleteUser($event)">I am sure, Yes delete it
              </button>
              }

            </mat-expansion-panel>
          </mat-accordion>

        </mat-card>
      </mat-tab>

      <mat-tab label="App settings">
        <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>
        <ng-template matTabLabel>
          <mat-icon matTooltip="General Settings">change_history</mat-icon>
        </ng-template>
        <mat-card class="mat-elevation-z0 qs-form-section">
          <mat-card-header>
            <mat-card-subtitle>
              App settings
            </mat-card-subtitle>
          </mat-card-header>
          <mat-divider></mat-divider>
          <mat-form-field>
            <mat-select placeholder="Theme that the app should use" formControlName="appTheme">
              @for (appTheme of appThemes | keyvalue; track appTheme) {
              <mat-option [value]="appTheme.value">
                {{appTheme.key}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> select according to you device's theme</mat-hint>
          </mat-form-field>
        </mat-card>
      </mat-tab>

      <mat-tab label="Dashboard Settings">
        <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>
        <ng-template matTabLabel>
          <mat-icon matTooltip="Dashboard settings">dashboard</mat-icon>
        </ng-template>

        <mat-card class="mat-elevation-z0 qs-form-section">

          <mat-card-header>
            <mat-card-subtitle>
              Dashboard settings
            </mat-card-subtitle>
          </mat-card-header>
          <mat-divider></mat-divider>

          <mat-form-field>

            <mat-select placeholder="Start of the week" formControlName="startOfTheWeek">
              <mat-option [value]="0">
                Sunday
              </mat-option>
              <mat-option [value]="1">
                Monday
              </mat-option>
              <mat-option [value]="2">
                Tuesday
              </mat-option>
              <mat-option [value]="3">
                Wednesday
              </mat-option>
              <mat-option [value]="4">
                Thursday
              </mat-option>
              <mat-option [value]="5">
                Friday
              </mat-option>
              <mat-option [value]="6">
                Saturday
              </mat-option>
            </mat-select>
            <mat-hint><b>Tip:</b> on this day the dashboard adjusts to</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Events per page" formControlName="eventsPerPage">
              @for (eventsPerPageOption of eventsPerPage ; track eventsPerPageOption) {
              <mat-option [value]="eventsPerPageOption">
                {{eventsPerPageOption}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> the more selected the slower the app will load on the dashboard view</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Hide ascent for activity types"
              formControlName="removeAscentForActivitiesSummaries" multiple>
              <mat-option>None</mat-option>
              @for (activityType of activityTypes; track activityType) {
              <mat-option [value]="activityType">
                {{activityType}}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>

        </mat-card>
      </mat-tab>


      <mat-tab label="Map Settings">
        <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>
        <ng-template matTabLabel>
          <mat-icon matTooltip="Map settings">map</mat-icon>
        </ng-template>

        <mat-card class="mat-elevation-z0 qs-form-section">

          <mat-card-header>
            <mat-card-subtitle>
              Map settings
            </mat-card-subtitle>
          </mat-card-header>
          <mat-divider></mat-divider>

          <mat-form-field>
            <mat-select placeholder="Theme that the map should use" formControlName="mapTheme">
              @for (mapTheme of mapThemes | keyvalue; track mapTheme) {
              <mat-option [value]="mapTheme.value">
                {{mapTheme.key}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> select according to you device's theme</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Map type that you prefer to use" formControlName="mapType">
              @for (mapType of mapTypes | keyvalue; track mapType) {
              <mat-option [value]="mapType.value">
                {{mapType.key}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> prefer satellite for non urban areas</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Lap types to show on the map" formControlName="mapLapTypes" multiple>
              @for (lapType of lapTypes; track lapType) {
              <mat-option [value]="lapType">
                {{lapType}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip</b>: select <b>distance</b> or <b>auto</b> for the <b>most common cases</b></mat-hint>
          </mat-form-field>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="showMapLaps">
              <span matTooltip="Show laps on map?">Show laps</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> laps can help in the track analysis</mat-hint>
          </section>
          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="showMapArrows">
              <span matTooltip="Show directional arrows on map?">Show directional arrows</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> arrows can help for understanding a complex track</mat-hint>
          </section>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="showMapPoints">
              <span matTooltip="Show points on map?">Show points</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> laps can help in the track analysis</mat-hint>
          </section>

          <section>
            <mat-hint matTooltip="How thick the map lines will be">
              Stroke width
            </mat-hint>
            <mat-slider [max]="10" [min]="0.05" [step]="0.05" discrete>
              <input matSliderThumb formControlName="mapStrokeWidth">
            </mat-slider>
          </section>

        </mat-card>
      </mat-tab>

      <mat-tab label="Chart Settings">
        <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>
        <ng-template matTabLabel>
          <mat-icon matTooltip="Chart settings">show_chart</mat-icon>
        </ng-template>

        <mat-card class="mat-elevation-z0 qs-form-section">

          <mat-card-header>
            <mat-card-subtitle>
              Chart settings
            </mat-card-subtitle>
          </mat-card-header>
          <mat-divider></mat-divider>

          <mat-form-field>
            <mat-select placeholder="XAxis chart type" formControlName="xAxisType">
              @for (xAxisType of xAxisTypes | keyvalue; track xAxisType) {
              <mat-option [value]="xAxisType.value">
                {{xAxisType.key}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> duration is the one that is most preferred</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Theme that the charts should use" formControlName="chartTheme">
              @for (chartTheme of chartThemes | keyvalue; track chartTheme) {
              <mat-option [value]="chartTheme.value">
                {{chartTheme.key}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> material and kelly are one of the best ðŸ˜‰</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="" formControlName="dataTypesToUse" multiple>
              @for (dataGroup of dataGroups; track dataGroup) {
              <mat-optgroup [label]="dataGroup.name" [disabled]="dataGroup.disabled">
                @for (data of dataGroup.data; track $index) {
                <mat-option [value]="data">
                  {{data}}
                </mat-option>
                }
              </mat-optgroup>
              }
            </mat-select>
            <mat-hint><b>Tip</b>: select the ones that you use <b>often</b></mat-hint>
          </mat-form-field>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="showAllData">
              <span matTooltip="Show all data?">Show all data</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> turn this on if you don't need any filtering or want to see all activity data
            </mat-hint>
          </section>
          <section>

            <mat-slide-toggle [color]="'accent'" formControlName="chartCursorBehaviour">
              <span matTooltip="Cursor selection by default?">Cursor selection</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> turn this on if you want the default behaviour of the cursor to be select (default is
              zoom)
            </mat-hint>
          </section>
          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="useAnimations">
              <span matTooltip="Use animations or no">Animations</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> this is experimental and might affect <b>performance</b></mat-hint>
          </section>
          <section>
            <mat-hint matTooltip="How thick the chart lines will be">
              Stroke width
            </mat-hint>
            <mat-slider [max]="10" [min]="0.05" [step]="0.05" discrete>
              <input matSliderThumb formControlName="chartStrokeWidth">
            </mat-slider>
          </section>
          <section>
            <mat-hint matTooltip="How vibrant the chart lines will be">
              Stroke opacity
            </mat-hint>
            <mat-slider [max]="1" [min]="0.05" [step]="0.05" discrete>
              <input matSliderThumb formControlName="chartStrokeOpacity">
            </mat-slider>
          </section>

          <section>
            <mat-hint matTooltip="How strong the fill color should be">
              Fill opacity
            </mat-hint>
            <mat-slider [max]="1" [min]="0.00" [step]="0.05" discrete>
              <input matSliderThumb formControlName="chartFillOpacity">
            </mat-slider>
          </section>

          <mat-form-field>
            <mat-select placeholder="Lap types to show on the chart" formControlName="chartLapTypes" multiple>
              @for (lapType of lapTypes; track lapType) {
              <mat-option [value]="lapType">
                {{lapType}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip</b>: select <b>distance</b> or <b>auto</b> for the <b>most common cases</b></mat-hint>
          </mat-form-field>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="showChartLaps">
              <span matTooltip="Show laps on chart?">Show laps</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> laps can help with the data analysis</mat-hint>
          </section>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="showChartGrid">
              <span matTooltip="Show grid on the chart?">Show grid</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> showing the grid can help with the data analysis</mat-hint>
          </section>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="stackYAxes">
              <span matTooltip="Stack Y axes?">Stack Y Axes</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> this will stack the charts on top of each other</mat-hint>
          </section>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="chartHideAllSeriesOnInit">
              <span matTooltip="Hide all series on chart initialization?">Hide all sereis on initialization</span>
            </mat-slide-toggle>
            <mat-hint><b>Tip:</b> this will create an empty chart</mat-hint>
          </section>

          <section>
            <mat-hint matTooltip="Improves the scalability for power analysis">
              Extra max for Power
            </mat-hint>
            <mat-slider [max]="0.9" [min]="-0.9" [step]="0.05" discrete>
              <input matSliderThumb formControlName="chartExtraMaxForPower">
            </mat-slider>
            <br />
            <mat-hint><b>Tip:</b> this will compress/decompress the power chart</mat-hint>
          </section>

          <section>
            <mat-hint matTooltip="Improves the scalability for pace analysis">
              Extra max for Pace
            </mat-hint>
            <mat-slider [max]="0.9" [min]="-0.9" [step]="0.05" discrete>
              <input matSliderThumb formControlName="chartExtraMaxForPace">
            </mat-slider>
            <br />
            <mat-hint><b>Tip:</b> this will compress/decompress the pace chart</mat-hint>
          </section>

          <section>
            <mat-hint matTooltip="How easy it is to calculate gain or loss">
              Gain and loss threshold
            </mat-hint>
            <mat-slider [max]="10" [min]="0.05" [step]="0.05" discrete>
              <input matSliderThumb formControlName="chartGainAndLossThreshold">
            </mat-slider>
            <br />
            <mat-hint><b>Tip:</b> use 5 (5m) if you are interested in a consistent filtering across data</mat-hint>
          </section>

          <section>
            <mat-slide-toggle [color]="'accent'" formControlName="chartDisableGrouping">
              <span matTooltip="Disable grouping of data?">Disable grouping</span>
            </mat-slide-toggle>
            <mat-hint><b>Grouping</b> "groups" the data to fit at the available screen pixel size.<br />
              This creates a more readable chart and improves performance by not calculating "those extra pixels"<br />
              The more you zoom on the chart, the more data is unfold on the chart.<br />
              However, if you use QS to mainly compare activities <b>at full zoomed out view</b>, eg heart rate or power
              from more than once device, you might want to experiment with this setting.<br />
              Disabling grouping it will load on the screen all available data and will impact performance.
            </mat-hint>
          </section>

          <section>
            <mat-hint matTooltip="How much downsampling will happen for activities that are over 6h">
              Down-sampling level
            </mat-hint>
            <mat-slider [max]="20" [min]="2" [step]="1" discrete>
              <input matSliderThumb formControlName="chartDownSamplingLevel">
            </mat-slider>
            <mat-hint>
              <br />
              <b>Down-sampling</b> keeps data every nth second according to what you've chosen for activities that are
              over 6 hours.<br />
              For example the default is 4 and that will keep the data from second 4,8,12 etc if the activity is
              6hours.<br />
              Raising this value can dramatically improve performance or lowering it improve details.
            </mat-hint>
          </section>
        </mat-card>
      </mat-tab>

      <mat-tab label="Unit Settings">
        <app-shade [isActive]="isSaving" [hasError]="errorSaving" [errorMessage]="errorSaving"></app-shade>
        <ng-template matTabLabel>
          <mat-icon matTooltip="Unit settings">multiline_chart</mat-icon>
        </ng-template>

        <mat-card class="mat-elevation-z0 qs-form-section">

          <mat-card-header>
            <mat-card-subtitle>
              Unit settings
            </mat-card-subtitle>
          </mat-card-header>
          <mat-divider></mat-divider>

          <mat-form-field>
            <mat-select placeholder="Units for speed" formControlName="speedUnitsToUse" multiple>
              @for (speedUnit of speedUnits | keyvalue; track speedUnit) {
              <mat-option [value]="speedUnit.value">
                {{speedUnit.value}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> you can select more than one</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Units for pace" formControlName="paceUnitsToUse" multiple>
              @for (paceUnit of paceUnits | keyvalue; track paceUnit) {
              <mat-option [value]="paceUnit.value">
                {{paceUnit.value}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> you can select more than one</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Units for swim pace" formControlName="swimPaceUnitsToUse" multiple>
              @for (swimPaceUnit of swimPaceUnits | keyvalue; track swimPaceUnit) {
              <mat-option [value]="swimPaceUnit.value">
                {{swimPaceUnit.value}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> you can select more than one</mat-hint>
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Units for vertical speed" formControlName="verticalSpeedUnitsToUse" multiple>
              @for (verticalSpeedUnit of verticalSpeedUnits | keyvalue; track verticalSpeedUnit) {
              <mat-option [value]="verticalSpeedUnit.value">
                {{verticalSpeedUnit.value}}
              </mat-option>
              }
            </mat-select>
            <mat-hint><b>Tip:</b> you can select more than one</mat-hint>
          </mat-form-field>
        </mat-card>

      </mat-tab>


    </mat-tab-group>

    @if (!hasError()) {
    <div class="qs-form-actions">
      <button mat-flat-button [disabled]="isSaving" color="primary" (click)="onSubmit($event)">
        Save
      </button>
    </div>
    }
  </form>
</div>