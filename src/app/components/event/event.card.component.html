<div class="event-dashboard-container">
  @if (isDownloading()) {
  <mat-progress-bar mode="indeterminate" class="global-download-progress"></mat-progress-bar>
  }


  @if (event()) {
  <app-event-summary [event]="event()!" [user]='currentUser()' [isOwner]="isOwner()"
    [selectedActivities]="selectedActivitiesInstant()" [unitSettings]="userUnitSettings()"
    [statsToShow]="basicStatsTypes">

    <!-- Projecting Intensity Zones after Stats Grid -->
    <!-- Projecting Intensity Zones after Stats Grid -->
    @if (hasIntensityZonesFlag()) {
    <div after-stats class="intensity-zones-summary-wrapper">
      <mat-divider></mat-divider>
      <app-event-intensity-zones [activities]="selectedActivitiesInstant()" [useAnimations]="useChartAnimations()"
        [chartTheme]="chartTheme()">
      </app-event-intensity-zones>
    </div>
    }

    <!-- Secondary Details Section -->
    <div summary-bottom class="secondary-details-container">
      <div class="responsive-grid">

        <!-- Map Section -->
        @if (event() && targetUserID() && hasPositionsFlag()) {
        <mat-card class="dashboard-card map-section glass-card">
          @if (selectedActivitiesDebounced().length > 0) {
          <app-event-card-map [selectedActivities]="selectedActivitiesDebounced()" [targetUserID]="targetUserID()"
            [user]="currentUser()!" [event]="event()!" [showLaps]="showMapLaps()" [showPoints]="showMapPoints()"
            [lapTypes]="mapLapTypes()" [showArrows]="showMapArrows()" [strokeWidth]="mapStrokeWidth()"
            [theme]="mapTheme()">
          </app-event-card-map>
          } @else {
          <div class="empty-selection-message">
            <mat-icon ripple>map</mat-icon>
            <span>Please select at least one activity to view the map.</span>
          </div>
          }
        </mat-card>
        }

        <!-- Chart Section -->
        @if (event() && targetUserID() && currentUser()) {
        <mat-card class="dashboard-card chart-section glass-card">
          @if (selectedActivitiesDebounced().length > 0) {
          <app-event-card-chart [showAllData]="showAllData()" [showLaps]="showChartLaps()"
            [useAnimations]="useChartAnimations()" [disableGrouping]="chartDisableGrouping()"
            [hideAllSeriesOnInit]="chartHideAllSeriesOnInit()" [gainAndLossThreshold]="chartGainAndLossThreshold()"
            [stackYAxes]="stackChartYAxes()" [showGrid]="showChartGrid()" [lapTypes]="chartLapTypes()"
            [xAxisType]="chartXAxisType()" [strokeWidth]="chartStrokeWidth()" [strokeOpacity]="chartStrokeOpacity()"
            [extraMaxForPower]="chartExtraMaxForPower()" [extraMaxForPace]="chartExtraMaxForPace()"
            [fillOpacity]="chartFillOpacity()" [selectedActivities]="selectedActivitiesDebounced()"
            [targetUserID]="targetUserID()" [dataTypesToUse]="chartDataTypesToUse()"
            [userUnitSettings]="userUnitSettings()" [user]="currentUser()!"
            [downSamplingLevel]="chartDownSamplingLevel()" [chartCursorBehaviour]="chartCursorBehaviour()"
            [chartTheme]="chartTheme()" [waterMark]="currentUser() ? currentUser()!.brandText : null" [event]="event()!"
            (loadingStatus)="isDownloading.set($event)">
          </app-event-card-chart>
          } @else {
          <div class="empty-selection-message">
            <mat-icon ripple>show_chart</mat-icon>
            <span>Please select at least one activity to view the chart.</span>
          </div>
          }
        </mat-card>
        }

        <!-- Laps Section -->
        @if (hasLapsFlag()) {
        <mat-card class="dashboard-card laps-section glass-card">
          <app-event-card-laps [selectedActivities]="selectedActivitiesInstant()" [unitSettings]="userUnitSettings()"
            [event]="event()!">
          </app-event-card-laps>
        </mat-card>
        }

      </div>
    </div>
  </app-event-summary>

  }
</div>