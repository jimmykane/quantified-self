<p class="description-text">
  Suunto is a trusted companion for athletes and adventurers. The durable and precise sports watches are tested in
  the toughest conditions and built to last in adventures from the deepest oceans to the highest mountains.
</p>

<div class="service-container">

  <!-- Pro Features Grid -->
  <h3 class="section-title">Pro Tools</h3>
  <div class="features-grid">

    <!-- Connectivity Card (Now inside Pro Grid) -->
    <mat-card class="feature-card glass-card" [class.locked]="!hasProAccess" [class.unlocked]="hasProAccess"
      (click)="!hasProAccess && triggerUpsell()">
      @if (!hasProAccess) {
      <div class="lock-overlay">
        <mat-icon class="lock-icon-large">lock</mat-icon>
        <span class="pro-badge">PRO</span>
      </div>
      }
      <mat-card-header>
        <mat-card-subtitle class="tab-subtitle">
          <mat-icon>sync</mat-icon>
          <span>{{ isConnectedToService() ? 'Connected' : 'Connect Account' }}</span>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="feature-card-content" style="align-items: stretch; text-align: left;">
        <mat-progress-bar mode="indeterminate" *ngIf="isLoading"></mat-progress-bar>

        @if (isConnectedToService()) {
        <mat-list style="width: 100%; padding: 0;">
          @for (serviceToken of serviceTokens; track serviceToken; let i = $index) {
          <mat-list-item style="height: auto; padding: 8px 0;">
            <mat-icon matListItemIcon (click)="clicks = clicks+1" style="margin-right: 8px;">account_circle</mat-icon>
            <div matListItemTitle style="font-size: 0.9rem;">{{ serviceToken.userName }} </div>
            <div matListItemLine style="font-size: 0.8rem; opacity: 0.7;">Connected: {{serviceToken.dateCreated |
              date:'short'}}</div>
          </mat-list-item>
          }
        </mat-list>
        }

        <div style="margin-top: auto; padding-top: 16px;">
          @if (!isConnectedToService() || clicks > 10) {
          <button mat-flat-button color="primary" style="width: 100%"
            [disabled]="!user || this.isGuest || isLoading || !hasProAccess" (click)="connectWithService($event)">
            <mat-icon>link</mat-icon> Connect
          </button>
          }

          @if (isConnectedToService()) {
          <button mat-stroked-button color="warn" style="width: 100%" [disabled]="isLoading || !hasProAccess"
            (click)="deauthorizeService($event)">
            <mat-icon>link_off</mat-icon> Disconnect
          </button>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- History Import Card -->
    <mat-card class="feature-card glass-card" [class.locked]="!hasProAccess" [class.unlocked]="hasProAccess"
      (click)="!hasProAccess && triggerUpsell()">
      <!-- Lock Overlay -->
      @if (!hasProAccess) {
      <div class="lock-overlay">
        <mat-icon class="lock-icon-large">lock</mat-icon>
        <span class="pro-badge">PRO</span>
      </div>
      }

      <mat-card-header>
        <mat-card-subtitle class="tab-subtitle">
          <mat-icon>history</mat-icon>
          <span>History Import</span>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-divider></mat-divider>

      <!-- Content (Blurred if locked) -->
      <div class="feature-card-content">
        <p class="feature-description" *ngIf="!hasProAccess">Import your full activity history from Suunto.</p>
        <app-history-import-form [serviceName]="serviceName"
          [userMetaForService]="serviceMeta"></app-history-import-form>
      </div>
    </mat-card>

    <!-- Download Card -->
    <mat-card class="feature-card glass-card" [class.locked]="!hasProAccess" [class.unlocked]="hasProAccess"
      (click)="!hasProAccess && triggerUpsell()">
      @if (!hasProAccess) {
      <div class="lock-overlay">
        <mat-icon class="lock-icon-large">lock</mat-icon>
        <span class="pro-badge">PRO</span>
      </div>
      }
      <mat-card-header>
        <mat-card-subtitle class="tab-subtitle">
          <mat-icon>cloud_download</mat-icon>
          <span>Download FIT</span>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-divider></mat-divider>

      <div class="feature-card-content">
        <p class="feature-description" *ngIf="!hasProAccess">Download FIT files directly from Suunto links.</p>
        <form style="width: 100%" [formGroup]="suuntoAppLinkFormGroup" (submit)="onSubmit()" autocomplete="off"
          class="qs-form">
          <mat-form-field appearance="outline">
            <mat-label>App Link</mat-label>
            <input matInput placeholder="https://..." formControlName="input">
            @if (hasError('input')) {
            <mat-error>Link Required</mat-error>
            }
          </mat-form-field>
          <div class="qs-form-actions" style="display: flex; gap: 8px;">
            <button mat-flat-button color="primary" [disabled]="isLoading" (click)="onSubmit()">
              Download
            </button>
            @if (user) {
            <button mat-flat-button color="accent" [disabled]="isLoading" (click)="onImportAndOpen()">
              Import
            </button>
            }
          </div>
        </form>
      </div>
    </mat-card>

    <!-- FIT Upload Card -->
    <mat-card class="feature-card glass-card" [class.locked]="!hasProAccess" [class.unlocked]="hasProAccess"
      (click)="!hasProAccess && triggerUpsell()">
      @if (!hasProAccess) {
      <div class="lock-overlay">
        <mat-icon class="lock-icon-large">lock</mat-icon>
        <span class="pro-badge">PRO</span>
      </div>
      }
      <mat-card-header>
        <mat-card-subtitle class="tab-subtitle">
          <mat-icon>cloud_upload</mat-icon>
          <span>FIT Upload</span>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-divider></mat-divider>

      <div class="feature-card-content">
        <p class="feature-description" *ngIf="!hasProAccess">Upload standard FIT files to Suunto.</p>
        <app-upload-activity-to-service [user]="user"></app-upload-activity-to-service>
      </div>
    </mat-card>

    <!-- GPX Upload Card -->
    <mat-card class="feature-card glass-card" [class.locked]="!hasProAccess" [class.unlocked]="hasProAccess"
      (click)="!hasProAccess && triggerUpsell()">
      @if (!hasProAccess) {
      <div class="lock-overlay">
        <mat-icon class="lock-icon-large">lock</mat-icon>
        <span class="pro-badge">PRO</span>
      </div>
      }
      <mat-card-header>
        <mat-card-subtitle class="tab-subtitle">
          <mat-icon svgIcon="route"></mat-icon>
          <span>GPX Upload</span>
        </mat-card-subtitle>
        @if (serviceMeta && serviceMeta.uploadedRoutesCount && serviceMeta.uploadedRoutesCount > 3) {
        <mat-card-subtitle class="smaller">
          {{serviceMeta.uploadedRoutesCount}} uploaded
        </mat-card-subtitle>
        }
      </mat-card-header>
      <mat-divider></mat-divider>

      <div class="feature-card-content">
        <p class="feature-description" *ngIf="!hasProAccess">Upload GPX routes to Suunto.</p>
        <app-upload-route-to-service [user]="user"></app-upload-route-to-service>
      </div>
    </mat-card>

  </div>
</div>
<app-shade [isActive]="isLoading"></app-shade>