@if (userMetaForService && userMetaForService.didLastHistoryImport && !isAllowedToDoHistoryImport) {
<mat-list>
  <div mat-subheader>Status</div>
  <mat-list-item style="text-align: left">
    <mat-icon mat-list-icon>date_range</mat-icon>
    <div mat-line>Your last history import was at</div>
    <div mat-line>{{ userMetaForService.didLastHistoryImport | date: 'medium'}}</div>
  </mat-list-item>
  @if (serviceName === serviceNames.SuuntoApp) {
  <mat-list-item style="text-align: left">
    <mat-icon mat-list-icon>confirmation_number</mat-icon>
    <div mat-line>Activities Queued</div>
    <div mat-line>{{ userMetaForService.processedActivitiesFromLastHistoryImportCount }} activities</div>
  </mat-list-item>
  }
  <mat-list-item style="text-align: left">
    <mat-icon mat-list-icon>replay</mat-icon>
    <div mat-line>You can run the next history import at</div>
    <div mat-line>{{ nextImportAvailableDate | date: 'medium'}}</div>
  </mat-list-item>

</mat-list>
}

@if (formGroup && isAllowedToDoHistoryImport) {
@if (isPro) {
<form [formGroup]="formGroup" class="qs-form history-import-form">
  <app-shade [isActive]="isLoading"></app-shade>
  <div class="date-fields">
    <mat-form-field appearance="outline">
      <mat-label>Start Date</mat-label>
      <input matInput [matDatepicker]="startDate" formControlName="startDate" (click)="startDate.open()">
      <mat-datepicker-toggle matSuffix [for]="startDate"></mat-datepicker-toggle>
      <mat-datepicker #startDate></mat-datepicker>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>End Date</mat-label>
      <input matInput [matDatepicker]="endDate" formControlName="endDate" (click)="endDate.open()">
      <mat-datepicker-toggle matSuffix [for]="endDate"></mat-datepicker-toggle>
      <mat-datepicker #endDate></mat-datepicker>
    </mat-form-field>
  </div>
  <div class="confirmation-section">
    <mat-checkbox formControlName="accepted">
      <span class="checkbox-label">
        @if (serviceName === serviceNames.SuuntoApp || serviceName === serviceNames.COROSAPI) {
        I understand this may take hours to days.
        }
        @if (serviceName === serviceNames.GarminHealthAPI) {
        I understand I can only import every 3 days.
        }
      </span>
    </mat-checkbox>
  </div>
  <div class="qs-form-actions">
    <button mat-flat-button color="primary" (click)="onSubmit($event)" [disabled]="!formGroup.valid">
      Import History
    </button>
  </div>
</form>
} @else {
<div class="pro-required">
  <p>History import is a Pro feature.</p>
  <button mat-flat-button color="primary" routerLink="/pricing">Upgrade to Pro</button>
</div>
}
}