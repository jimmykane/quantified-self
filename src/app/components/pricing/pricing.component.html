<div class="pricing-container">
  <h1>{{ isPremium ? 'Your Subscription' : 'Choose Your Plan' }}</h1>

  @if (isPremium) {
  <div class="manage-subscription-container">
    <mat-card class="product-card">
      <mat-card-header>
        <mat-card-title>Premium Membership</mat-card-title>
        <mat-card-subtitle>You are currently subscribed.</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content class="manage-content">
        <p>Thank you for supporting Quantified Self!</p>
        <button mat-flat-button color="primary" (click)="manageSubscription()" [disabled]="isLoading">
          @if (isLoading) {
          <mat-spinner diameter="20"></mat-spinner>
          } @else {
          Manage Subscription
          }
        </button>
      </mat-card-content>
    </mat-card>
  </div>
  } @else {
  <div class="products-grid" *ngIf="products$ | async as products; else loading">
    <mat-card *ngFor="let product of products" class="product-card">
      <mat-card-header>
        <mat-card-title>{{ product.name }}</mat-card-title>
        <mat-card-subtitle>{{ product.description }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div *ngFor="let price of product.prices" class="price-section">
          <h3 class="price">
            {{ (price.unit_amount || 0) / 100 | currency: price.currency.toUpperCase() }}
            <span *ngIf="price.recurring">/ {{ price.recurring.interval }}</span>
          </h3>
          <button mat-flat-button color="primary" (click)="subscribe(price.id)" [disabled]="isLoading">
            @if (loadingPriceId === price.id) {
            <mat-spinner diameter="20"></mat-spinner>
            } @else {
            {{ price.recurring ? 'Subscribe' : 'Buy Now' }}
            }
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <ng-template #loading>
    <p>Loading plans...</p>
  </ng-template>
  }
</div>